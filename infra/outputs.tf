# =============================================================================
# outputs.tf — 출력값 정의 파일
# =============================================================================
# terraform apply가 완료된 후, 사용자에게 보여줄 정보를 정의합니다.
# 예: 생성된 서버의 IP 주소, SSH 접속 명령어 등
#
# 실행 후 출력 예시:
#   public_ip   = "13.125.xxx.xxx"
#   ssh_command = "ssh -i ~/.ssh/my-key.pem ubuntu@13.125.xxx.xxx"
#   n8n_url     = "http://13.125.xxx.xxx:5678"
#
# 나중에 다시 보려면: terraform output
# 특정 값만 보려면: terraform output public_ip
# =============================================================================

# -----------------------------------------------------------------------------
# public_ip: EC2에 연결된 고정 공인 IP
# -----------------------------------------------------------------------------
# Elastic IP(고정 IP)의 주소를 출력합니다.
# 이 IP로 SSH 접속, 웹 브라우저 접속 등을 할 수 있습니다.
output "public_ip" {
  description = "EC2 Elastic IP (고정)"
  value       = aws_eip.n8n_poc.public_ip  # aws_eip 리소스에서 할당된 공인 IP 참조
}

# -----------------------------------------------------------------------------
# ssh_command: SSH 접속 명령어 (복사해서 터미널에 바로 붙여넣기용)
# -----------------------------------------------------------------------------
# EC2에 SSH로 접속하는 전체 명령어를 자동 생성해줍니다.
# - ~/.ssh/${키이름}.pem: SSH 프라이빗 키 파일 경로
# - ubuntu@: Ubuntu AMI의 기본 사용자 이름
output "ssh_command" {
  description = "SSH 접속 명령어"
  value       = "ssh -i ~/.ssh/${var.key_name}.pem ubuntu@${aws_eip.n8n_poc.public_ip}"
  # ${var.key_name}: variables.tf에서 정의한 키 페어 이름
  # ${aws_eip.n8n_poc.public_ip}: 위에서 출력한 고정 IP
}

# -----------------------------------------------------------------------------
# n8n_url: n8n 웹 UI 접속 URL
# -----------------------------------------------------------------------------
# 브라우저에서 이 URL을 열면 n8n 워크플로우 편집기에 접속할 수 있습니다.
# n8n은 기본적으로 5678 포트를 사용합니다.
output "n8n_url" {
  description = "n8n UI 접속 URL"
  value       = "http://${aws_eip.n8n_poc.public_ip}:5678"
}

# -----------------------------------------------------------------------------
# instance_id: EC2 인스턴스 고유 ID
# -----------------------------------------------------------------------------
# AWS에서 이 서버를 식별하는 고유 ID입니다 (예: i-0abc1234def56789).
# AWS 콘솔에서 인스턴스를 찾거나, AWS CLI로 조작할 때 사용합니다.
output "instance_id" {
  description = "EC2 인스턴스 ID"
  value       = aws_instance.n8n_poc.id  # aws_instance 리소스의 ID 참조
}